# AI Agent 层精读笔记

> 精读时间：2026-01-22 | 源文档：02-ai-agent（5 篇合并）

## 根节点命题

**在远程零部署约束下，通过 Command Block 上下文 + Bash 工具集，实现与本地 CLI Agent 对齐的能力**

---

## 设计原则

| 原则 | 说明 |
|------|------|
| **零部署** | 远程环境无需安装任何二进制 |
| **渐进增强** | 分阶段演进能力 |
| **上下文感知** | 基于 Command Block 提供环境上下文 |
| **安全优先** | 危险操作需确认 |

---

## 能力演进路线

| 阶段 | 时间 | 能力 |
|------|------|------|
| **第一期** | 2026.06 | 命令生成 + 错误诊断 |
| **第二期** | 2026.12 | TUI 交互 + 任务自动化 |
| **第三期** | 2027.06 | 旁路观测 + 多 Agent 协同 |

---

## 五大能力模块

### 1. 命令生成

自然语言 → 上下文注入 → LLM 生成 → 安全检查 → Shell 命令

**上下文**：pwd / git_branch / shell_type / recent_commands

**安全分级**：
- danger：拒绝执行（如 rm -rf /）
- warning：需确认（如 rm -rf ./temp）
- safe：直接执行

### 2. 错误诊断

| 错误特征 | 诊断类型 | 修复方向 |
|----------|---------|---------|
| command not found | 命令未安装 | 安装或加 PATH |
| permission denied | 权限不足 | sudo 或 chmod |
| No such file | 文件不存在 | 检查路径 |

**触发**：exit_code != 0 + 用户执行的命令

### 3. 旁路观测 AI

**特点**：被动观测，不主动干预

| 触发类型 | 条件 | 示例 |
|---------|------|------|
| 超时触发 | 执行 > 3s 无输出 | sudo 等待密码 |
| 关键词触发 | 屏幕出现提示 | [y/N] |
| 进程状态 | 前台进程等待 | ssh 确认 |

**安全红线**：密码输入只提示不填充，SSH 确认必须手动

### 4. TUI 交互

在 vim/k9s/htop 中使用自然语言：

"删除所有空行" → :g/^$/d + Enter → PTY 发送给 vim

**上下文**：屏幕内容 + 光标位置 + TUI 应用类型

### 5. 任务规划

复杂任务 → 任务分解 → 生成计划 → 串行/并行执行 → 汇总结果

---

## 工具集（Bash 实现）

| 类型 | 命令 |
|------|------|
| 文件操作 | cat / head / tail / grep / find |
| Git 操作 | git status / diff / log / branch |
| 容器操作 | docker ps / logs / exec |
| K8s 操作 | kubectl get / describe / apply |

**核心约束**：所有工具通过 Bash 标准命令实现，零部署

---

## 记忆系统

| 层级 | 持久化 | 内容 |
|------|--------|------|
| 会话记忆 | 否 | 当前对话、进行中任务 |
| 项目记忆 | 是 | 项目类型、构建命令 |
| 用户偏好 | 是 | 编辑器、Shell、语言 |

---

## 思考与洞见

### Bash 工具集 vs 专用 CLI

| 方面 | Bash 工具集 | 专用 CLI |
|------|------------|---------|
| 部署成本 | 零 | 需要安装 |
| 能力上限 | 受限 | 更强 |
| 跨平台 | 依赖 Shell 差异 | 统一 |

WeTERM 选择 Bash 是因为「零部署」是核心约束

### 旁路观测的价值

传统 Agent 是「主动干预」，旁路观测是「被动建议」——只在用户卡住时才出手。这种设计减少了 Agent 的侵入感，符合「渐进增强」原则。

---

## 关联文档

- Command Block：Agent 的上下文来源
- Prompt Manager：管理各能力的 Prompt
- ACP 协议：第三期与本地 Agent 集成
