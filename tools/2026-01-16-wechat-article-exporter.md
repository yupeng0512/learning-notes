# 微信公众号文章导出器 - 批量下载神器精读

> **项目地址**：https://github.com/wechat-article/wechat-article-exporter
> **精读日期**：2026-01-16
> **阅读价值**：⭐⭐⭐⭐⭐ 技术实现巧妙，架构清晰，工程实践优秀

---

## 📖 快速概览

| 项目 | 内容 |
|------|------|
| **名称** | wechat-article-exporter（微信公众号文章导出器） |
| **作者** | wechat-article 组织 |
| **类型** | 开源 Web 工具 |
| **技术栈** | Nuxt 3 + Vue 3 + Tailwind CSS + Dexie.js + Nitro |
| **核心功能** | 批量下载公众号文章（正文、配图、评论），支持多格式导出 |

> **一句话总结**：通过「曲线救国」思路（借用公众号后台的文章搜索功能）实现公众号文章批量下载，前端为主 + 服务端代理的现代架构。

---

## 🗺️ 技术架构

```
┌────────────────────────────────────────────────────────────┐
│                wechat-article-exporter                      │
├────────────────────────────────────────────────────────────┤
│  ┌──────────┐    ┌──────────┐    ┌──────────────────┐     │
│  │ 前端 UI  │───▶│ API 代理 │───▶│ 微信公众号后台 API │     │
│  │ (Nuxt 3) │    │ (Nitro)  │    │                  │     │
│  └──────────┘    └──────────┘    └──────────────────┘     │
│       │               │                                    │
│       ▼               ▼                                    │
│  ┌──────────┐    ┌──────────┐                             │
│  │IndexedDB │    │ KV 存储  │                             │
│  │(Dexie.js)│    │ (Cookie) │                             │
│  └──────────┘    └──────────┘                             │
│                                                            │
│  导出格式: HTML | Markdown | Excel | JSON | TXT | Word    │
└────────────────────────────────────────────────────────────┘
```

### 数据流向

```
用户浏览器（前端）                 服务端（Nitro）              微信服务器
    │                                  │                          │
    │──扫码登录─────────────────────▶│───代理请求────────────▶│
    │                                  │◀──返回 Cookie──────────│
    │◀──返回 auth-key──────────────────│                          │
    │                                  │                          │
    │──请求文章列表(带 auth-key)──────▶│───附加 Cookie 代理────▶│
    │◀──返回文章数据───────────────────│◀──返回数据──────────────│
    │                                  │                          │
    │  【前端处理】                     │                          │
    │  - 解析数据                       │                          │
    │  - 存入 IndexedDB                 │                          │
    │  - 下载资源                       │                          │
    │  - 生成导出文件                   │                          │
```

---

## 📚 核心洞见

### 1. 「借力打力」策略 - 核心原理

**问题**：微信公众号文章是封闭平台，没有公开 API，直接爬取面临反爬风险。

**解决方案**：利用公众号后台的一个「隐藏功能」：

> 在公众号后台写文章时，支持**搜索其他公众号的文章**作为引用素材。

这意味着：
- 任何拥有公众号的用户，都可以通过后台搜索任意公众号的文章
- 微信提供了相应的内部 API（`appmsgpublish`）来支持这个功能
- 该接口返回文章的完整元信息（标题、链接、封面、发布时间等）

| 普通思路 | 本项目思路 |
|---------|-----------|
| 直接爬取微信文章页面 | 利用公众号后台「搜索文章」功能的内部 API |
| 面临反爬风险 | 官方接口，稳定合法 |
| 需要处理各种反爬机制 | 只需公众号账号即可 |

**类比理解**：

想象你去图书馆（微信公众号平台）：
- 普通访客只能看到公开展示的书籍（文章页面）
- 但如果你有图书馆员工卡（公众号账号），就可以使用内部系统搜索任意馆藏
- 这个工具就是帮你自动化使用这个「内部系统」

### 2. 前端为主的架构设计

| 设计选择 | 原因 | 效果 |
|----------|------|------|
| Cookie 存服务端 | Cookie 包含敏感信息，不能暴露给浏览器 | 安全性 ✅ |
| 数据处理在前端 | 减轻服务器压力，支持私有化部署 | 成本低 ✅ |
| IndexedDB 缓存 | 大文件（HTML/图片）不适合频繁传输 | 性能好 ✅ |
| File System API | 直接写入本地，无需服务器中转 | 体验好 ✅ |

**类比理解**：就像外卖平台：
- 服务端 = 外卖骑手（负责跑腿取餐/代理请求）
- 前端 = 你家厨房（负责整理餐食/数据处理）
- IndexedDB = 你家冰箱（存储食材/缓存数据）

### 3. 关键概念

| 概念 | 定义 | 为什么重要 |
|------|------|------------|
| **fakeid** | 公众号的唯一标识符 | 用于区分不同公众号，是文章列表接口的核心参数 |
| **token** | 公众号后台会话凭证 | 调用微信接口必需，决定 API 调用权限 |
| **appmsgpublish** | 微信的文章发布接口 | 核心数据来源，获取文章列表的关键接口 |
| **credentials** | 抓包获取的凭证信息 | 用于获取阅读量、评论等高级数据 |

---

## 🛠️ 多格式导出实现

项目使用**策略模式**组织导出逻辑：

| 格式 | 核心技术 | 特殊处理 |
|------|----------|----------|
| HTML | DOM 解析 + 资源打包 | 图片/样式替换为本地路径，100% 还原 |
| Markdown | TurndownService | HTML → MD 高质量转换 |
| Excel | exceljs | 支持包含正文内容 |
| JSON | 原生序列化 | 可选包含评论数据 |
| Word | html-docx.js | HTML → DOCX 转换 |
| TXT | 纯文本提取 | 去除所有格式 |

### HTML 导出的资源处理流程

```typescript
// 1. 提取 HTML 中的资源 URL
const imgs = document.querySelectorAll<HTMLImageElement>('img');
for (const img of imgs) {
  const imgUrl = img.getAttribute('src') || img.getAttribute('data-src');
  if (imgUrl) resources.push(imgUrl);
}

// 2. 正则提取背景图片
html.replaceAll(
  /(background-image: url\()([^)]+)(\))/gs,
  (_, p1, url, p3) => {
    resources.push(url);
    return `${p1}${url}${p3}`;
  }
);

// 3. 下载资源并替换路径
for (const resourceUrl of resourceMap.resources) {
  const resource = await getResourceCache(resourceUrl);
  await this.writeFile(dirname + `/assets/${uuid}.${ext}`, resource.file);
  urlmap.set(resourceUrl, `./assets/${uuid}.${ext}`);
}
```

---

## 💬 评论抓取机制

评论数据需要额外的凭证（credentials），这些凭证无法通过公众号后台获取，需要用户手动抓包：

| 字段 | 含义 | 来源 |
|------|------|------|
| `__biz` | 公众号标识 | 文章 URL 参数 |
| `pass_ticket` | 通行凭证 | 抓包获取 |
| `key` | 签名密钥 | 抓包获取 |
| `uin` | 用户标识 | 抓包获取 |

**为什么需要抓包**：微信的评论接口有防盗链机制，必须从微信客户端或公众号页面发起请求，需要携带用户特定的签名信息。

---

## 🚀 部署方式对比

| 方面 | Docker | Cloudflare |
|------|--------|------------|
| **成本** | 需要自己服务器 | 免费套餐可用 |
| **性能** | 取决于服务器配置 | 全球边缘节点 |
| **数据隐私** | 完全自控 | 数据经过 CF 服务器 |
| **维护** | 需要自己维护 | 托管服务，省心 |
| **存储** | 文件系统持久化 | KV 存储（有配额限制） |

**适用场景**：
- **Docker**：对数据隐私要求高、有自己服务器、需要持久化存储
- **Cloudflare**：快速部署、全球访问、轻量使用

---

## 💡 技术亮点总结

| 技巧 | 应用场景 | 效果 |
|------|----------|------|
| Dexie.js 本地存储 | 大量数据缓存 | 优雅的 IndexedDB 封装 |
| File System Access API | 文件导出 | 直接写入本地文件系统 |
| TurndownService | HTML 转 Markdown | 高质量格式转换 |
| 代理请求封装 | 绕过 CORS 限制 | 服务端代理微信 API |
| 策略模式 | 多格式导出 | 代码组织清晰，易扩展 |

---

## ⚠️ 常见误区

| 误区 | 正确做法 |
|------|----------|
| ❌ 直接爬取微信文章页面 | ✅ 通过公众号后台接口获取，合规且稳定 |
| ❌ 将 Cookie 存储在前端 | ✅ 服务端 KV 存储，返回 auth-key 给前端 |
| ❌ 同步下载所有资源 | ✅ 使用队列并发控制，避免被限流 |

---

## ✅ 行动清单

### 立即可做
- [ ] 访问 [在线版本](https://down.mptext.top) 体验功能
- [ ] 注册一个测试公众号（如果没有的话）

### 短期实践
- [ ] 尝试导出自己关注的公众号文章
- [ ] 研究项目源码中的 `Exporter.ts`，理解导出流程
- [ ] 如果需要评论数据，学习抓包获取 credentials

### 长期提升
- [ ] 基于此项目的架构思路，思考其他「曲线救国」的数据获取方案
- [ ] 学习 Dexie.js 的 IndexedDB 封装技巧
- [ ] 了解 File System Access API 的使用场景

---

## 📚 延伸阅读

- [Nuxt 3 官方文档](https://nuxt.com/docs)
- [Dexie.js 文档](https://dexie.org/)
- [File System Access API](https://developer.chrome.com/docs/capabilities/web-apis/file-system-access)
- [WeChat_Article 原始项目](https://github.com/1061700625/WeChat_Article)（灵感来源）

---

## 📋 一页纸总结

### 核心要点（5 条）

1. **核心原理**：利用公众号后台「搜索文章」功能的内部 API，实现合法的文章数据获取
2. **架构特点**：前端为主（数据处理、存储、导出），服务端仅做代理（绕过 CORS、保护 Cookie）
3. **存储策略**：Dexie.js 封装 IndexedDB，缓存文章、HTML、资源，支持断点续传
4. **导出实现**：策略模式支持多格式，HTML 导出会打包图片和样式实现 100% 还原
5. **部署选择**：Docker 适合隐私敏感场景，Cloudflare 适合轻量快速部署

### 技术栈速记

```
前端: Nuxt 3 + Vue 3 + Tailwind CSS + Dexie.js
后端: Nitro (Nuxt 的服务端引擎)
存储: IndexedDB (前端) + KV/FS (后端 Cookie)
导出: TurndownService + exceljs + html-docx.js + JSZip
```

### 金句摘录

> "在公众号后台写文章时支持搜索其他公众号的文章功能，以此来实现抓取指定公众号所有文章的目的。"
> —— README.md 原理说明
